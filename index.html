<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Para Você</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #000;
    font-family: 'Cormorant Garamond', serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ─── VIDEOS ─── */
  .video-layer {
    position: fixed;
    top: 50%; left: 50%;
    min-width: 100%; min-height: 100%;
    width: auto; height: auto;
    transform: translate(-50%, -50%);
    object-fit: cover;
    opacity: 0;
    z-index: 1;
    pointer-events: none;
    will-change: opacity;
    transition: opacity 4s ease;
  }
  .video-layer.active { opacity: 1; z-index: 2; }
  .video-layer.fading-out { opacity: 0; z-index: 1; }

  /* ─── INFINITY CANVAS ─── */
  #infinity-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: 0;
    opacity: 0;
    pointer-events: none;
    transition: opacity 4s ease;
  }
  #infinity-canvas.active { opacity: 1; }

  /* ─── FADE TO BLACK ─── */
  #fade-to-black {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: #000; z-index: 3;
    opacity: 0; pointer-events: none;
  }

  /* ─── CINEMATIC OVERLAYS ─── */
  .vignette {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none; z-index: 10;
    background: radial-gradient(ellipse at center, transparent 35%, rgba(0,0,0,0.5) 100%);
  }

  .film-grain {
    position: fixed; top: -50%; left: -50%;
    width: 200%; height: 200%;
    pointer-events: none; z-index: 11; opacity: 0.025;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    animation: grain 0.5s steps(1) infinite;
  }
  @keyframes grain {
    0%   { transform: translate(0,0); }
    20%  { transform: translate(-4%,-4%); }
    40%  { transform: translate(4%,4%); }
    60%  { transform: translate(-2%,3%); }
    80%  { transform: translate(3%,-2%); }
    100% { transform: translate(0,0); }
  }

  .letterbox { position: fixed; left: 0; width: 100%; background: #000; z-index: 12; pointer-events: none; }
  .letterbox.top { top: 0; height: 5.5vh; }
  .letterbox.bottom { bottom: 0; height: 5.5vh; }
  @media (max-width: 768px) { .letterbox.top { height: 3vh; } .letterbox.bottom { height: 3vh; } }

  #color-grade {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 9;
    mix-blend-mode: soft-light; opacity: 0;
    transition: background 5s ease, opacity 5s ease;
  }

  /* ─── TEXT — more legible ─── */
  #overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center;
    pointer-events: none; z-index: 20;
  }

  .cinematic-text {
    color: #fff;
    font-weight: 300;
    font-size: clamp(1.15rem, 3.2vw, 2.15rem);
    text-align: center;
    max-width: 72vw;
    line-height: 1.9;
    letter-spacing: 0.1em;
    opacity: 0;
    transform: translateY(14px);
    transition: opacity 3s ease, transform 3.2s ease;
    text-shadow:
      0 0 20px rgba(0,0,0,1),
      0 0 50px rgba(0,0,0,0.95),
      0 0 100px rgba(0,0,0,0.8),
      0 2px 8px rgba(0,0,0,1);
    padding: 0 1.5rem;
  }
  .cinematic-text.visible { opacity: 1; transform: translateY(0); }

  @media (max-width: 768px) {
    .cinematic-text {
      max-width: 88vw; line-height: 2;
      letter-spacing: 0.06em;
      font-size: clamp(1.05rem, 4.8vw, 1.45rem);
    }
  }

  /* ─── START SCREEN ─── */
  #start-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 100; cursor: pointer;
    transition: opacity 3s ease;
  }
  #start-screen.hidden { opacity: 0; pointer-events: none; }

  #start-screen h1 {
    color: #F2F2F2; font-weight: 300;
    font-size: clamp(1.5rem, 4.5vw, 2.8rem);
    letter-spacing: 0.22em; margin-bottom: 2rem; text-transform: lowercase;
  }
  #start-screen .subtitle {
    color: rgba(242,242,242,0.2); font-weight: 300; font-style: italic;
    font-size: clamp(0.75rem, 1.8vw, 0.95rem);
    letter-spacing: 0.14em; margin-bottom: 3rem;
  }
  .play-btn {
    width: 62px; height: 62px;
    border: 1px solid rgba(242,242,242,0.2); border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 1.5rem; transition: all 0.5s ease;
  }
  .play-btn:hover { border-color: rgba(242,242,242,0.45); transform: scale(1.07); }
  .play-btn svg { width: 16px; height: 16px; fill: rgba(242,242,242,0.45); margin-left: 3px; }
  .play-hint {
    color: rgba(242,242,242,0.22); font-weight: 300;
    font-size: clamp(0.6rem, 1.4vw, 0.75rem);
    letter-spacing: 0.35em; text-transform: uppercase;
    animation: breathe 3s ease-in-out infinite;
  }
  @keyframes breathe { 0%,100% { opacity: 0.15; } 50% { opacity: 0.5; } }

  /* ─── PROGRESS ─── */
  #progress-bar {
    position: fixed; bottom: 0; left: 0; height: 2px;
    background: linear-gradient(90deg, rgba(242,242,242,0.02), rgba(242,242,242,0.15));
    z-index: 25; width: 0%; transition: width 0.4s linear, opacity 2s ease;
  }

  /* ─── FINAL OVERLAY ─── */
  #final-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 30; opacity: 0; pointer-events: none;
    transition: opacity 4s ease;
  }
  #final-overlay.visible { opacity: 1; pointer-events: auto; }

  #final-overlay .heart {
    font-size: clamp(1.6rem, 3vw, 2.2rem);
    color: rgba(255,255,255,0.75);
    margin-bottom: 1rem;
    animation: heartbeat 2.5s ease-in-out infinite;
    text-shadow: 0 0 30px rgba(255,255,255,0.12);
  }
  @keyframes heartbeat {
    0%,100% { transform: scale(1); }
    15% { transform: scale(1.12); }
    30% { transform: scale(1); }
    45% { transform: scale(1.08); }
    60% { transform: scale(1); }
  }

  #final-overlay .final-text {
    color: rgba(255,255,255,0.65);
    font-weight: 300; font-style: italic;
    font-size: clamp(0.9rem, 2.2vw, 1.15rem);
    letter-spacing: 0.12em; margin-bottom: 2.5rem;
    text-shadow: 0 0 20px rgba(0,0,0,0.5);
  }

  #replay-btn {
    color: rgba(255,255,255,0.25);
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300; font-size: 0.72rem;
    letter-spacing: 0.3em; text-transform: lowercase;
    background: none; border: 1px solid rgba(255,255,255,0.12);
    padding: 0.5rem 1.5rem; cursor: pointer; border-radius: 2px;
    opacity: 0; pointer-events: none;
    transition: opacity 3s ease, border-color 0.4s ease, color 0.4s ease;
  }
  #replay-btn.visible { opacity: 1; pointer-events: auto; }
  #replay-btn:hover { color: rgba(255,255,255,0.55); border-color: rgba(255,255,255,0.3); }

  /* ─── LOADING ─── */
  #loading {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 150;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    transition: opacity 1.5s ease;
  }
  #loading.hidden { opacity: 0; pointer-events: none; }
  #loading .load-text {
    color: rgba(242,242,242,0.35); font-weight: 300;
    font-size: 0.82rem; letter-spacing: 0.3em;
    text-transform: lowercase; margin-bottom: 1.5rem;
  }
  #loading .load-bar-bg { width: 100px; height: 1px; background: rgba(242,242,242,0.08); overflow: hidden; }
  #loading .load-bar { height: 100%; width: 0%; background: rgba(242,242,242,0.35); transition: width 0.3s ease; }
</style>
</head>
<body>

<div id="loading">
  <div class="load-text">preparando</div>
  <div class="load-bar-bg"><div class="load-bar" id="load-bar"></div></div>
</div>

<div id="start-screen" style="display:none;">
  <h1>para você</h1>
  <div class="subtitle">uma jornada</div>
  <div class="play-btn"><svg viewBox="0 0 24 24"><polygon points="8,5 19,12 8,19"/></svg></div>
  <div class="play-hint">toque para iniciar</div>
</div>

<video id="vid-forest" class="video-layer" muted playsinline preload="auto" src="forest.mp4"></video>
<video id="vid-ocean"  class="video-layer" muted playsinline preload="auto" loop src="ocean.mp4"></video>
<video id="vid-sky"    class="video-layer" muted playsinline preload="auto" loop src="sky.mp4"></video>
<video id="vid-space"  class="video-layer" muted playsinline preload="auto" src="space.mp4"></video>

<video id="vid-infinity-src" muted playsinline preload="auto" src="infinity.mp4" style="display:none;"></video>
<canvas id="infinity-canvas"></canvas>

<div id="fade-to-black"></div>

<div class="vignette"></div>
<div class="film-grain"></div>
<div id="color-grade"></div>
<div class="letterbox top"></div>
<div class="letterbox bottom"></div>

<div id="overlay">
  <div id="cinematic-text" class="cinematic-text"></div>
</div>

<div id="final-overlay">
  <div class="heart">&#10084;</div>
  <div class="final-text">com amor, para sempre</div>
  <button id="replay-btn">assistir novamente</button>
</div>

<div id="progress-bar"></div>

<script>
(function() {
  'use strict';

  // ═══════════════════════════════════════
  //  PHASES
  // ═══════════════════════════════════════
  const PHASES = [
    {
      id: 'forest', videoStart: 0, videoEnd: 10,
      textStart: 1.5, textEnd: 8.5,
      text: "Entre milhões de caminhos possíveis…\neu encontrei você.",
      grade: 'linear-gradient(180deg, rgba(30,60,30,0.25) 0%, transparent 50%, rgba(15,25,10,0.2) 100%)',
      gradeOpacity: 0.12
    },
    {
      id: 'ocean', videoStart: 7.5, videoEnd: 23,
      textStart: 12, textEnd: 20.5,
      text: "Você tem a profundidade de quem\nnão precisa provar nada.",
      grade: 'linear-gradient(180deg, rgba(15,40,70,0.3) 0%, transparent 50%, rgba(8,18,35,0.2) 100%)',
      gradeOpacity: 0.15
    },
    {
      id: 'sky', videoStart: 20.5, videoEnd: 38,
      textStart: 26, textEnd: 35,
      text: "Você tem o dom de clarear\nqualquer dia.",
      grade: 'linear-gradient(180deg, rgba(50,70,90,0.2) 0%, transparent 50%, rgba(35,45,60,0.15) 100%)',
      gradeOpacity: 0.1
    },
    {
      id: 'space', videoStart: 35.5, videoEnd: 999,
      textStart: 41, textEnd: 54,
      text: "Entre tudo que poderia ser…\nfoi você.",
      grade: 'linear-gradient(180deg, rgba(8,8,25,0.4) 0%, transparent 50%, rgba(4,4,12,0.3) 100%)',
      gradeOpacity: 0.2
    }
  ];

  // ─── ELEMENTS ───
  const vids = {
    forest: document.getElementById('vid-forest'),
    ocean:  document.getElementById('vid-ocean'),
    sky:    document.getElementById('vid-sky'),
    space:  document.getElementById('vid-space')
  };

  const infinitySrc    = document.getElementById('vid-infinity-src');
  const infinityCanvas = document.getElementById('infinity-canvas');
  const ctx            = infinityCanvas.getContext('2d');

  const loading      = document.getElementById('loading');
  const loadBar      = document.getElementById('load-bar');
  const startScreen  = document.getElementById('start-screen');
  const textEl       = document.getElementById('cinematic-text');
  const progressBar  = document.getElementById('progress-bar');
  const colorGrade   = document.getElementById('color-grade');
  const fadeToBlack  = document.getElementById('fade-to-black');
  const finalOverlay = document.getElementById('final-overlay');
  const replayBtn    = document.getElementById('replay-btn');

  let isPlaying = false, startTime = 0, currentText = '', currentPhaseId = '';
  let spaceEnded = false, fadeStarted = false, infinityRevealed = false;
  let infinityRunning = false, infinityDir = 1;

  // ─── INFINITY PING-PONG ───
  let infDuration = 0;
  let infTime = 0;
  let lastInfTick = 0;

  function setupCanvas() {
    const w = infinitySrc.videoWidth || 1920;
    const h = infinitySrc.videoHeight || 1080;
    // Match screen aspect
    const screenRatio = window.innerWidth / window.innerHeight;
    const vidRatio = w / h;
    if (vidRatio > screenRatio) {
      infinityCanvas.height = window.innerHeight;
      infinityCanvas.width = window.innerHeight * vidRatio;
    } else {
      infinityCanvas.width = window.innerWidth;
      infinityCanvas.height = window.innerWidth / vidRatio;
    }
  }

  function startInfinity() {
    if (infinityRunning) return;
    infinityRunning = true;
    infinityDir = 1;
    infTime = 0;
    infDuration = infinitySrc.duration || 10;
    infinitySrc.currentTime = 0;
    infinitySrc.play().catch(() => {});
    setupCanvas();
    infinityCanvas.classList.add('active');
    lastInfTick = performance.now();
    drawInfinity();
  }

  function drawInfinity() {
    if (!infinityRunning) return;
    requestAnimationFrame(drawInfinity);

    const now = performance.now();
    const dt = (now - lastInfTick) / 1000;
    lastInfTick = now;

    // Advance or rewind time
    infTime += dt * infinityDir;

    // Bounce at boundaries
    if (infTime >= infDuration) {
      infTime = infDuration - 0.01;
      infinityDir = -1;
      infinitySrc.pause();
    }
    if (infTime <= 0) {
      infTime = 0.01;
      infinityDir = 1;
      infinitySrc.currentTime = 0;
      infinitySrc.play().catch(() => {});
    }

    // When going forward, let video play naturally
    // When going backward, seek manually
    if (infinityDir === -1) {
      infinitySrc.currentTime = infTime;
    }

    // Draw to canvas
    try {
      ctx.drawImage(infinitySrc, 0, 0, infinityCanvas.width, infinityCanvas.height);
    } catch(e) {}
  }

  function stopInfinity() {
    infinityRunning = false;
    infinitySrc.pause();
    infinitySrc.currentTime = 0;
    infinityCanvas.classList.remove('active');
  }

  // ─── LOAD ───
  const loadKeys = ['forest','ocean','sky','space'];
  let loaded = 0;
  const totalToLoad = 5;

  function onReady() {
    loaded++;
    loadBar.style.width = (loaded / totalToLoad * 100) + '%';
    if (loaded >= totalToLoad) {
      setTimeout(() => {
        loading.classList.add('hidden');
        setTimeout(() => { startScreen.style.display = 'flex'; }, 400);
      }, 600);
    }
  }

  loadKeys.forEach(key => {
    const v = vids[key];
    v.addEventListener('canplaythrough', function h() { v.removeEventListener('canplaythrough', h); onReady(); });
    v.addEventListener('error', function h() { v.removeEventListener('error', h); onReady(); });
    setTimeout(() => { if (loaded < totalToLoad) onReady(); }, 15000);
    v.load();
  });

  infinitySrc.addEventListener('canplaythrough', function h() { infinitySrc.removeEventListener('canplaythrough', h); onReady(); });
  infinitySrc.addEventListener('error', function h() { infinitySrc.removeEventListener('error', h); onReady(); });
  setTimeout(() => { if (loaded < totalToLoad) onReady(); }, 15000);
  infinitySrc.load();

  // ─── SPACE ENDED → triggers fade ───
  vids.space.addEventListener('ended', function() {
    spaceEnded = true;
  });

  // ─── MAIN ENGINE ───
  function tick(now) {
    if (!isPlaying) return;
    requestAnimationFrame(tick);

    const time = (now - startTime) / 1000;

    // ─── Phase video switching ───
    if (!spaceEnded) {
      let active = PHASES[0];
      for (let i = PHASES.length - 1; i >= 0; i--) {
        if (time >= PHASES[i].videoStart) { active = PHASES[i]; break; }
      }

      if (active.id !== currentPhaseId) {
        // Fade out previous
        if (currentPhaseId && vids[currentPhaseId]) {
          const prev = vids[currentPhaseId];
          prev.classList.remove('active');
          prev.classList.add('fading-out');
          const old = currentPhaseId;
          setTimeout(() => {
            if (vids[old]) {
              vids[old].classList.remove('fading-out');
              if (old !== 'space') vids[old].pause();
            }
          }, 4500);
        }

        // Fade in next
        const next = vids[active.id];
        next.currentTime = 0;
        next.play().catch(() => {});
        next.classList.remove('fading-out');
        next.classList.add('active');

        colorGrade.style.background = active.grade;
        colorGrade.style.opacity = active.gradeOpacity;

        currentPhaseId = active.id;
      }

      // Progress (estimate based on space video)
      const spaceDur = vids.space.duration || 30;
      const totalEstimate = PHASES[3].videoStart + spaceDur;
      progressBar.style.width = Math.min(100, (time / totalEstimate * 100)) + '%';
    }

    // ─── Text ───
    let newText = '';
    for (const p of PHASES) {
      if (time >= p.textStart && time <= p.textEnd) { newText = p.text; break; }
    }

    if (newText !== currentText) {
      if (newText === '') {
        textEl.classList.remove('visible');
      } else {
        textEl.innerHTML = newText.replace(/\n/g, '<br>');
        textEl.classList.remove('visible');
        requestAnimationFrame(() => {
          requestAnimationFrame(() => { textEl.classList.add('visible'); });
        });
      }
      currentText = newText;
    }

    // ─── Space ended → 3s fade to black ───
    if (spaceEnded && !fadeStarted) {
      fadeStarted = true;
      textEl.classList.remove('visible');
      currentText = '';

      // Start infinity behind black
      startInfinity();

      // 3s fade to black
      fadeToBlack.style.transition = 'opacity 3s ease';
      fadeToBlack.style.opacity = '1';

      progressBar.style.width = '100%';

      // After black, reveal infinity
      setTimeout(() => {
        // Kill phase videos
        loadKeys.forEach(k => {
          vids[k].classList.remove('active','fading-out');
          vids[k].pause();
        });
        colorGrade.style.opacity = '0';

        // Slowly lift black
        fadeToBlack.style.transition = 'opacity 4s ease';
        fadeToBlack.style.opacity = '0';

        progressBar.style.opacity = '0';
      }, 3500);

      // Show final
      setTimeout(() => { finalOverlay.classList.add('visible'); }, 6000);
      setTimeout(() => { replayBtn.classList.add('visible'); }, 8000);
    }
  }

  // ─── START ───
  function start() {
    startScreen.classList.add('hidden');
    setTimeout(() => {
      isPlaying = true;
      spaceEnded = false;
      fadeStarted = false;
      startTime = performance.now();
      currentPhaseId = '';
      currentText = '';
      requestAnimationFrame(tick);
    }, 900);
  }

  startScreen.addEventListener('click', start);
  startScreen.addEventListener('touchend', e => { e.preventDefault(); start(); });

  // ─── REPLAY ───
  replayBtn.addEventListener('click', () => {
    // Hide everything
    finalOverlay.classList.remove('visible');
    replayBtn.classList.remove('visible');
    textEl.classList.remove('visible');
    progressBar.style.width = '0%';
    progressBar.style.opacity = '1';
    colorGrade.style.opacity = '0';
    currentText = '';
    currentPhaseId = '';
    spaceEnded = false;
    fadeStarted = false;

    // Reset fade
    fadeToBlack.style.transition = 'none';
    fadeToBlack.style.opacity = '0';

    // Stop infinity
    stopInfinity();

    // Stop all videos
    loadKeys.forEach(k => {
      vids[k].classList.remove('active','fading-out');
      vids[k].pause();
      vids[k].currentTime = 0;
    });

    // Brief pause then restart
    setTimeout(() => {
      isPlaying = true;
      startTime = performance.now();
      requestAnimationFrame(tick);
    }, 800);
  });

  // ─── RESIZE ───
  window.addEventListener('resize', () => {
    if (infinityRunning) setupCanvas();
  });

})();
</script>
</body>
</html>